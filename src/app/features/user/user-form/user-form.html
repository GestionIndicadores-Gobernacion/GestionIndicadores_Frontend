<div class="min-h-screen bg-zinc-50">

  <!-- HEADER -->
  <div class="border-b border-zinc-200 bg-white">
    <div class="max-w-3xl mx-auto px-6 py-8">
      <div class="flex items-start justify-between">
        <div class="space-y-1">
          <h1 class="text-2xl font-semibold text-zinc-900 tracking-tight">
            {{ isEdit ? 'Editar usuario' : 'Nuevo usuario' }}
          </h1>
          <p class="text-sm text-zinc-500">
            {{ isEdit ? 'Actualiza la información del usuario' : 'Completa los datos para crear un nuevo usuario' }}
          </p>
        </div>
        <button type="button" [routerLink]="['/users']"
          class="text-sm text-zinc-400 hover:text-zinc-900 transition-colors duration-150 cursor-pointer">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-6 py-10">

    <!-- LOADING -->
    <div *ngIf="loading" class="bg-white border border-zinc-200 rounded-2xl p-12">
      <div class="flex flex-col items-center justify-center gap-3">
        <div class="w-5 h-5 border-2 border-zinc-300 border-t-zinc-900 rounded-full animate-spin"></div>
        <p class="text-sm text-zinc-500">Cargando formulario...</p>
      </div>
    </div>

    <!-- FORM -->
    <form *ngIf="!loading" (ngSubmit)="save()" class="space-y-6">

      <!-- INFORMACIÓN PERSONAL -->
      <section class="bg-white border border-zinc-200 rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-zinc-100">
          <h2 class="text-xs font-semibold uppercase tracking-wider text-zinc-900">
            Información personal
          </h2>
        </div>

        <div class="p-6 grid md:grid-cols-2 gap-5">

          <!-- Nombre -->
          <div class="space-y-1.5">
            <label class="block text-xs font-medium text-zinc-700">
              Nombre *
            </label>
            <input type="text" name="first_name" [(ngModel)]="form.first_name" required [disabled]="isMainAdmin()"
              [class.border-red-300]="attemptedSubmit && !form.first_name" class="w-full px-3 py-2 text-sm border border-zinc-200 rounded-lg
                     bg-white text-zinc-900
                     focus:outline-none focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900
                     disabled:bg-zinc-50 disabled:text-zinc-500
                     transition-colors duration-150" placeholder="Juan" />
            <p *ngIf="attemptedSubmit && !form.first_name" class="text-xs text-red-600">
              El nombre es obligatorio
            </p>
          </div>

          <!-- Apellido -->
          <div class="space-y-1.5">
            <label class="block text-xs font-medium text-zinc-700">
              Apellido *
            </label>
            <input type="text" name="last_name" [(ngModel)]="form.last_name" required [disabled]="isMainAdmin()"
              [class.border-red-300]="attemptedSubmit && !form.last_name" class="w-full px-3 py-2 text-sm border border-zinc-200 rounded-lg
                     bg-white text-zinc-900
                     focus:outline-none focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900
                     disabled:bg-zinc-50 disabled:text-zinc-500
                     transition-colors duration-150" placeholder="Pérez" />
            <p *ngIf="attemptedSubmit && !form.last_name" class="text-xs text-red-600">
              El apellido es obligatorio
            </p>
          </div>

        </div>
      </section>

      <!-- CREDENCIALES -->
      <section class="bg-white border border-zinc-200 rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-zinc-100">
          <h2 class="text-xs font-semibold uppercase tracking-wider text-zinc-900">
            Credenciales de acceso
          </h2>
        </div>

        <div class="p-6 space-y-5">

          <!-- Email -->
          <div class="space-y-1.5">
            <label class="block text-xs font-medium text-zinc-700">
              Correo electrónico *
            </label>
            <input type="email" name="email" [(ngModel)]="form.email" required [disabled]="isMainAdmin()"
              [class.border-red-300]="attemptedSubmit && (!form.email || !isValidEmail(form.email))" class="w-full px-3 py-2 text-sm border border-zinc-200 rounded-lg
                     bg-white text-zinc-900
                     focus:outline-none focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900
                     disabled:bg-zinc-50 disabled:text-zinc-500
                     transition-colors duration-150" placeholder="usuario@gobernacion.gov.co" />
            <p *ngIf="attemptedSubmit && !form.email" class="text-xs text-red-600">
              El correo es obligatorio
            </p>
            <p *ngIf="attemptedSubmit && form.email && !isValidEmail(form.email)" class="text-xs text-red-600">
              Ingresa un correo válido
            </p>
          </div>

          <!-- Contraseña -->
          <div class="space-y-1.5">
            <label class="block text-xs font-medium text-zinc-700">
              Contraseña {{ isEdit ? '' : '*' }}
            </label>
            <input type="password" name="password" [(ngModel)]="form.password" [required]="!isEdit"
              [disabled]="isMainAdmin()" [class.border-red-300]="attemptedSubmit && passwordInvalid()" class="w-full px-3 py-2 text-sm border border-zinc-200 rounded-lg
                     bg-white text-zinc-900
                     focus:outline-none focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900
                     disabled:bg-zinc-50 disabled:text-zinc-500
                     transition-colors duration-150"
              [placeholder]="isEdit ? 'Dejar en blanco para no modificar' : 'Mínimo 6 caracteres'" />
            <p *ngIf="attemptedSubmit && !isEdit && !form.password" class="text-xs text-red-600">
              La contraseña es obligatoria
            </p>
            <p *ngIf="attemptedSubmit && isEdit && form.password && form.password.length < 6"
              class="text-xs text-red-600">
              Mínimo 6 caracteres
            </p>
            <p *ngIf="isEdit && !isMainAdmin()" class="text-xs text-zinc-500">
              Solo completa este campo si deseas cambiar la contraseña
            </p>
          </div>

        </div>
      </section>

      <!-- ROL Y PERMISOS -->
      <section class="bg-white border border-zinc-200 rounded-2xl overflow-hidden">
        <div class="px-6 py-4 border-b border-zinc-100">
          <h2 class="text-xs font-semibold uppercase tracking-wider text-zinc-900">
            Rol y permisos
          </h2>
        </div>

        <div class="p-6">
          <div class="space-y-1.5">
            <label class="block text-xs font-medium text-zinc-700">
              Rol *
            </label>
            <select name="role_id" [(ngModel)]="form.role_id" required [disabled]="isMainAdmin()"
              [class.border-red-300]="attemptedSubmit && !form.role_id" class="w-full px-3 py-2 text-sm border border-zinc-200 rounded-lg
                     bg-white text-zinc-900
                     focus:outline-none focus:border-zinc-900 focus:ring-1 focus:ring-zinc-900
                     disabled:bg-zinc-50 disabled:text-zinc-500
                     transition-colors duration-150 cursor-pointer">
              <option [ngValue]="null" disabled>Seleccionar rol...</option>
              <option *ngFor="let r of roles" [ngValue]="r.id">
                {{ r.name }}
              </option>
            </select>
            <p *ngIf="attemptedSubmit && !form.role_id" class="text-xs text-red-600">
              Debes seleccionar un rol
            </p>
            <p *ngIf="!isMainAdmin()" class="text-xs text-zinc-500">
              Define el nivel de acceso del usuario
            </p>
          </div>
        </div>
      </section>

      <!-- BOTONES -->
      <div class="pt-6 flex items-center justify-end gap-3">
        <button type="button" [routerLink]="['/users']" class="px-4 py-2 text-sm font-medium text-zinc-600 
                 hover:text-zinc-900 transition-colors duration-150 cursor-pointer">
          Cancelar
        </button>

        <button *ngIf="isMainAdmin()" type="button" disabled class="px-6 py-2 text-sm font-medium text-white bg-zinc-400 rounded-lg
                 cursor-not-allowed">
          Usuario principal — No editable
        </button>

        <button *ngIf="!isMainAdmin()" type="submit" class="px-6 py-2 text-sm font-medium text-white bg-zinc-900 rounded-lg
                 hover:bg-black transition-colors duration-150
                 disabled:opacity-40 disabled:cursor-not-allowed cursor-pointer" [disabled]="saving">
          {{ saving ? 'Guardando...' : (isEdit ? 'Actualizar usuario' : 'Crear usuario') }}
        </button>
      </div>

    </form>

  </div>

</div>