<div class="component-form-container form-container">

  <h2 class="page-title">
    {{ isEdit ? "Editar Componente" : "Crear Componente" }}
  </h2>

  <div *ngIf="loading" class="loading-box">
    <div class="spinner"></div>
  </div>

  <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="submit()">

    <div class="form-section">

      <!-- ========================= -->
      <!-- Estrategia -->
      <!-- ========================= -->
      <div class="form-group">
        <label>Estrategia</label>

        <select
          formControlName="strategy_id"
          (change)="onStrategyChange(form.get('strategy_id')?.value)"
          [class.invalid]="showError('strategy_id')">

          <option value="" disabled>Seleccione una estrategia...</option>
          <option *ngFor="let s of strategies" [value]="s.id">
            {{ s.name }}
          </option>
        </select>

        <div class="error-message" *ngIf="showError('strategy_id')">
          Debe seleccionar una estrategia.
        </div>
      </div>

      <!-- ========================= -->
      <!-- Actividad -->
      <!-- ========================= -->
      <div class="form-group">
        <label>Actividad</label>

        <select
          formControlName="activity_id"
          [disabled]="filteredActivities.length === 0"
          [class.invalid]="showError('activity_id')">

          <option value="" disabled>Seleccione una actividad...</option>
          <option *ngFor="let a of filteredActivities" [value]="a.id">
            {{ a.description }}
          </option>
        </select>

        <div class="error-message" *ngIf="showError('activity_id')">
          Debe seleccionar una actividad.
        </div>
      </div>

      <!-- ========================= -->
      <!-- Nombre -->
      <!-- ========================= -->
      <div class="form-group">
        <label>Nombre</label>

        <input
          type="text"
          formControlName="name"
          placeholder="Nombre del componente"
          [class.invalid]="showError('name')">

        <div class="error-message" *ngIf="showError('name')">
          <span *ngIf="form.get('name')?.errors?.['required']">
            El nombre es obligatorio.
          </span>
          <span *ngIf="form.get('name')?.errors?.['minlength']">
            Debe tener mínimo 3 caracteres.
          </span>
        </div>
      </div>

      <!-- ========================= -->
      <!-- Tipo de dato -->
      <!-- ========================= -->
      <div class="form-group">
        <label>Tipo de dato</label>

        <select
          formControlName="data_type"
          [class.invalid]="showError('data_type')">

          <option value="" disabled>Seleccione un tipo de dato...</option>
          <option value="integer">Entero</option>
          <option value="decimal">Decimal</option>
          <option value="boolean">Booleano</option>
          <option value="text">Texto</option>
          <option value="date">Fecha</option>
          <option value="category">Categoría (lista)</option>
        </select>

        <div class="error-message" *ngIf="showError('data_type')">
          Seleccione un tipo de dato.
        </div>
      </div>

      <!-- ========================= -->
      <!-- Descripción -->
      <!-- ========================= -->
      <div class="form-group full">
        <label>Descripción</label>
        <textarea
          rows="3"
          formControlName="description"
          placeholder="Descripción del componente">
        </textarea>
      </div>

      <!-- ========================= -->
      <!-- Activo -->
      <!-- ========================= -->
      <div class="form-group">
        <label>Activo</label>
        <label class="switch">
          <input type="checkbox" formControlName="active">
          <span class="slider"></span>
        </label>
      </div>

    </div>

    <!-- ========================= -->
    <!-- Acciones -->
    <!-- ========================= -->
    <div class="form-actions">
      <button class="btn-primary" [disabled]="saving || form.invalid">
        {{ saving ? "Guardando..." : (isEdit ? "Actualizar Componente" : "Crear Componente") }}
      </button>

      <button
        type="button"
        class="btn-secondary-custom"
        [routerLink]="['/records/components']">
        Cancelar
      </button>
    </div>

  </form>

</div>
