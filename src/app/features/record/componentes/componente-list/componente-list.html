<div class="records-container">

  <div class="records-header">
    <h2>Gesti√≥n de Componentes</h2>
    <button class="btn-primary" (click)="goToCreate()">Crear Componente</button>
  </div>

  <div class="search-box">
    <input type="text" placeholder="Buscar por nombre, actividad o estrategia..." [(ngModel)]="search"
      (input)="applyFilter()">
  </div>

  <div *ngIf="!loading" class="table-wrapper">

    <div *ngIf="paginatedComponents.length === 0" class="empty-state">
      <p>No hay componentes registrados.</p>
    </div>

    <ng-container *ngIf="paginatedComponents.length > 0">
      <table class="custom-table">

        <thead>
          <tr>
            <th (click)="sortBy('name')" class="sortable">
              Nombre
              <span *ngIf="sortColumn === 'name'">
                {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
              </span>
            </th>

            <th (click)="sortBy('description')" class="sortable">
              Descripci√≥n
              <span *ngIf="sortColumn === 'description'">
                {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
              </span>
            </th>

            <!-- üî• Estrategia -->
            <th (click)="sortBy('strategy')" class="sortable">
              Estrategia
              <span *ngIf="sortColumn === 'strategy'">
                {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
              </span>
            </th>

            <th (click)="sortBy('activity_id')" class="sortable">
              Actividad
              <span *ngIf="sortColumn === 'activity_id'">
                {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
              </span>
            </th>

            <th (click)="sortBy('active')" class="sortable">
              Estado
              <span *ngIf="sortColumn === 'active'">
                {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
              </span>
            </th>

            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let c of paginatedComponents">
            <td>{{ c.name }}</td>
            <td>{{ c.description || 'Sin descripci√≥n' }}</td>

            <!-- Estrategia (derivada) -->
            <td>
              {{ strategyMap[activityStrategyMap[c.activity_id]] || '‚Äî' }}
            </td>

            <!-- Actividad -->
            <td>
              {{ activityMap[c.activity_id] || '‚Äî' }}
            </td>

            <td>
              <span class="state-badge" [class.active]="c.active" [class.inactive]="!c.active">
                {{ c.active ? 'Activo' : 'Inactivo' }}
              </span>
            </td>

            <td class="actions-col">
              <button class="btn-outline-primary" (click)="goToEdit(c.id)">
                Editar
              </button>
              <button class="btn-outline-danger" (click)="deleteComponent(c.id)">
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>

      </table>
    </ng-container>

    <!-- PAGINACI√ìN -->
    <app-pagination [currentPage]="currentPage" [totalPages]="totalPages" (pageChange)="currentPage = $event">
    </app-pagination>


  </div>

</div>