<div class="record-form-container">

  <!-- T铆tulo -->
  <h2 class="page-title">
    {{ isEdit ? "Editar Indicador" : "Crear Indicador" }}
  </h2>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-box">
    <div class="spinner"></div>
  </div>

  <form *ngIf="!loading" (ngSubmit)="save()">

    <!-- ========================== -->
    <!--  UBICACIN               -->
    <!-- ========================== -->
    <div class="form-section">
      <h3 class="section-title">Ubicaci贸n del indicador</h3>

      <div class="row g-4">

        <!-- ESTRATEGIA -->
        <div class="col-lg-4 col-md-6">
          <label class="form-label">Estrategia</label>
          <select class="form-select" name="strategy"
            [(ngModel)]="selectedStrategy"
            (change)="filterComponents()"
            [class.invalid]="!selectedStrategy && attemptedSubmit"
            required>

            <option value="" disabled>Seleccionar estrategia...</option>
            <option *ngFor="let s of strategies" [value]="s.id">
              {{ s.name }}
            </option>
          </select>
        </div>

        <!-- COMPONENTE -->
        <div class="col-lg-4 col-md-6">
          <label class="form-label">Componente</label>
          <select class="form-select" name="component_id"
            [(ngModel)]="form.component_id"
            [disabled]="!selectedStrategy"
            [class.invalid]="!form.component_id && attemptedSubmit"
            required>

            <option value="" disabled>Seleccionar componente...</option>
            <option *ngFor="let c of filteredComponents" [value]="c.id">
              {{ c.name }}
            </option>
          </select>
        </div>

      </div>
    </div>

    <!-- ========================== -->
    <!--  DEFINICIN              -->
    <!-- ========================== -->
    <div class="form-section">
      <h3 class="section-title">Definici贸n del indicador</h3>

      <div class="row g-4">

        <!-- NOMBRE -->
        <div class="col-lg-6 col-md-12">
          <label class="form-label">Nombre del indicador</label>
          <input class="form-control"
            type="text"
            name="name"
            [(ngModel)]="form.name"
            [disabled]="!form.component_id"
            [class.invalid]="(!form.name || form.name.trim().length < 3) && attemptedSubmit"
            required>
        </div>

        <!-- META -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label">Meta</label>
          <input type="number"
            class="form-control"
            name="meta"
            [(ngModel)]="form.meta"
            min="1"
            placeholder="Ej: 100"
            [disabled]="!form.component_id"
            [class.invalid]="attemptedSubmit && (!form.meta || form.meta <= 0)"
            required>
        </div>

      </div>
    </div>

    <!-- ========================== -->
    <!--  CONFIGURACIN           -->
    <!-- ========================== -->
    <div class="form-section">
      <h3 class="section-title">Configuraci贸n</h3>

      <div class="row g-4 align-items-end">

        <!-- TIPO DE DATO -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label">Tipo de dato</label>
          <select class="form-select"
            name="data_type"
            [(ngModel)]="form.data_type"
            [disabled]="!form.component_id"
            required>

            <option value="">Seleccione...</option>
            <option value="integer">Entero</option>
            <option value="float">Decimal</option>
            <option value="boolean">Booleano</option>
            <option value="string">Texto</option>
            <option value="date">Fecha</option>
          </select>
        </div>

        <!-- SWITCHES -->
        <div class="col-lg-6 col-md-12">
          <label class="form-label">Comportamiento del indicador</label>

          <div class="d-flex gap-5 mt-2">

            <!-- ES POBLACIONAL -->
            <div class="d-flex flex-column">
              <label class="form-label mb-1">Indicador poblacional</label>
              <label class="switch">
                <input type="checkbox"
                  name="es_poblacional"
                  [(ngModel)]="form.es_poblacional"
                  [disabled]="!form.component_id">
                <span class="slider"></span>
              </label>
              <small class="text-muted">Mide personas</small>
            </div>

            <!-- ACTIVO -->
            <div class="d-flex flex-column">
              <label class="form-label mb-1">Activo</label>
              <label class="switch">
                <input type="checkbox"
                  name="active"
                  [(ngModel)]="form.active"
                  [disabled]="!form.component_id">
                <span class="slider"></span>
              </label>
            </div>

          </div>
        </div>

      </div>
    </div>

    <!-- ========================== -->
    <!--  DESCRIPCIN             -->
    <!-- ========================== -->
    <div class="form-section">
      <h3 class="section-title">Descripci贸n</h3>

      <textarea rows="3"
        class="form-control"
        name="description"
        [(ngModel)]="form.description"
        placeholder="Descripci贸n del indicador (opcional)"
        [disabled]="!form.component_id">
      </textarea>
    </div>

    <!-- ========================== -->
    <!--  BOTONES                 -->
    <!-- ========================== -->
    <div class="form-actions">
      <button class="btn-primary" [disabled]="saving">
        {{ saving ? "Guardando..." : (isEdit ? "Actualizar Indicador" : "Crear Indicador") }}
      </button>

      <button type="button"
        class="btn-secondary-custom"
        [routerLink]="['/records/indicators']">
        Cancelar
      </button>
    </div>

  </form>
</div>
