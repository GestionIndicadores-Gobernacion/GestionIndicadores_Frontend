<div class="record-detail">

  <!-- HEADER -->
  <div class="detail-header">
    <div>
      <h2>Detalle del Informe</h2>
      <p class="subtitle">
        {{ strategyMap[record?.strategy_id!] }} ·
        {{ activityMap[record?.activity_id!] }} ·
        {{ componentMap[record?.component_id!] }}
      </p>
    </div>

    <button class="btn-back" (click)="back()">← Volver</button>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading-box">
    <div class="spinner"></div>
  </div>

  <div *ngIf="!loading && record">

    <!-- METADATA -->
    <div class="meta-card">
      <div>
        <span>Fecha del informe</span>
        <strong>{{ record.fecha | date:'mediumDate' }}</strong>
      </div>

      <div>
        <span>Registrado el</span>
        <strong>{{ record.fecha_registro | date:'medium' }}</strong>
      </div>
    </div>

    <!-- RESUMEN -->
    <section class="section">
      <h3>Resumen ejecutivo</h3>
      <p *ngIf="record.description; else noDesc">
        {{ record.description }}
      </p>
      <ng-template #noDesc>
        <p class="empty">Sin resumen registrado.</p>
      </ng-template>
    </section>

    <!-- ACTIVIDADES -->
    <section class="section">
      <h3>Actividades realizadas</h3>
      <p *ngIf="record.actividades_realizadas; else noAct">
        {{ record.actividades_realizadas }}
      </p>
      <ng-template #noAct>
        <p class="empty">Sin actividades registradas.</p>
      </ng-template>
    </section>

    <!-- MUNICIPIOS -->
    <section class="section">
      <h3>Resultados por municipio</h3>

      <div *ngIf="municipios.length === 0" class="empty">
        No hay municipios registrados.
      </div>

      <div class="municipios-grid">

        <div *ngFor="let muni of municipios" class="municipio-card">
          <h4>{{ muni }}</h4>

          <div *ngFor="let ind of getIndicadoresForMunicipio(muni)" class="indicador-row">

            <div class="indicador-header">
              <span>{{ ind.nombre }}</span>
              <strong>Total: {{ ind.total }}</strong>
            </div>

            <!-- DETALLE POBLACIONAL -->
            <div *ngIf="ind.tipos" class="poblacion-detail">
              <div>Mujeres: {{ ind.tipos.mujeres }}</div>
              <div>Población afro: {{ ind.tipos.poblacion_afro }}</div>
              <div>Discapacidad: {{ ind.tipos.discapacidad }}</div>
            </div>

          </div>
        </div>

      </div>
    </section>

    <!-- EVIDENCIA -->
    <section class="section">
      <h3>Evidencia</h3>

      <a *ngIf="record.evidencia_url; else noEv" class="evidence-btn" [href]="record.evidencia_url" target="_blank">
        Abrir evidencia
      </a>

      <ng-template #noEv>
        <p class="empty">No se adjuntó evidencia.</p>
      </ng-template>
    </section>

  </div>
</div>