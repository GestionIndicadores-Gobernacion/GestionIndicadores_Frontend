<div class="record-view-container">

    <div class="header-row">
        <h2>Detalle del Registro</h2>
        <button class="btn-secondary" (click)="back()">‚Üê Volver</button>
    </div>

    <!-- LOADING -->
    <div *ngIf="loading" class="loading-box">
        <div class="spinner"></div>
    </div>

    <!-- CONTENT -->
    <div *ngIf="!loading && record">

        <!-- ============================
               üìå DATOS GENERALES
        ============================ -->
        <div class="view-card">
            <h3>Datos generales</h3>

            <div class="info-grid">
                <div class="info-item">
                    <span>Municipio</span>
                    {{ record.municipio }}
                </div>

                <div class="info-item">
                    <span>Fecha</span>
                    {{ record.fecha | date:'mediumDate' }}
                </div>

                <div class="info-item">
                    <span>Registrado el</span>
                    {{ record.fecha_registro | date:'mediumDate' }}
                </div>
            </div>
        </div>

        <!-- ============================
               üìå COMPONENTE / INDICADOR
        ============================ -->
        <div class="view-card">
            <h3>Componente e Indicador</h3>

            <div class="info-grid">

                <div class="info-item">
                    <span>Componente</span>
                    {{
                        record.component_id !== null
                            ? componentMap[record.component_id]
                            : 'Sin componente'
                    }}
                </div>

                <div class="info-item">
                    <span>Indicador</span>
                    {{
                        record.indicator_id !== null
                            ? indicatorMap[record.indicator_id ?? 0] || '‚Äî'
                            : 'Sin indicador'
                    }}
                </div>

            </div>
        </div>

        <!-- ============================
               üìå POBLACI√ìN
        ============================ -->
        <div class="view-card">
            <h3>Poblaci√≥n</h3>

            <span class="sub-label">Tipo de poblaci√≥n</span>

            <div class="chips">
                <span class="chip" *ngFor="let t of record.tipo_poblacion">
                    {{ t }}
                </span>
            </div>

            <!-- Detalle poblacional (solo si existe y no est√° vac√≠o) -->
            <div *ngIf="record.detalle_poblacion && (record.detalle_poblacion | keyvalue).length > 0">
                <span class="sub-label mt-3">Detalle por tipo</span>

                <table class="detail-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let kv of record.detalle_poblacion | keyvalue">
                            <td>{{ kv.key }}</td>
                            <td>{{ kv.value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <!-- ============================
               üìå EVIDENCIA
        ============================ -->
        <div class="view-card">
            <h3>Evidencia</h3>

            <ng-container *ngIf="record.evidencia_url; else noEvidence">
                <a class="evidence-link" [href]="record.evidencia_url" target="_blank">
                    {{ record.evidencia_url }}
                </a>
            </ng-container>

            <ng-template #noEvidence>
                <p class="no-evidence">Sin evidencia adjunta</p>
            </ng-template>
        </div>

    </div>
</div>
